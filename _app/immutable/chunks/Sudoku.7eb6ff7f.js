import{s as H,e as P,i as R,y as J,G as F,d as q,f as I,l as A,a as C,g as T,h as B,m as K,H as ge,c as M,j as D,I as b,K as me,J as j,L as ve,n as we,M as U}from"./scheduler.f51c602a.js";import{S as W,i as X,b as k,d as V,m as S,a as N,t as y,e as E}from"./index.aa7fb691.js";import{a as L,b as be,d as qe}from"./store.fe9c387a.js";const Ue=(t,e)=>{if(t<0||t>8)throw new Error(`unexpected square position: ${t}`);const l=Math.floor(t/3),a=t%3,n=3*l,s=3*a;return[e[n][s],e[n][s+1],e[n][s+2],e[n+1][s],e[n+1][s+1],e[n+1][s+2],e[n+2][s],e[n+2][s+1],e[n+2][s+2]]},He=(t,e)=>{if(t.fixed)throw new Error("Tried to update fixed cell");if(!e.length){t.value=void 0,t.notes=[];return}if(e.length===1){t.value=e[0],t.notes=[];return}t.value=void 0,t.notes=[...e]},ke=()=>{const t=[];for(let e=0;e<9;e++){t.push([]);for(let l=0;l<9;l++){const a={value:void 0,fixed:!1,notes:[1,2,3,4,5,6,7,8,9]};t[t.length-1].push(a)}}return t},Y=t=>{for(let u=0;u<9;u++){const h=new Set,p=new Set;for(let f=0;f<9;f++){const $=t[u][f].value;if($){if(h.has($))return console.log("duplicate in row",u),!0;h.add($)}const m=t[f][u].value;if(m){if(p.has(m))return console.log("duplicate in col",u),!0;p.add(m)}}}const e=new Set,l=new Set,a=new Set,n=new Set,s=new Set,r=new Set,c=new Set,o=new Set,v=new Set;for(let u=0;u<3;u++)for(let h=0;h<3;h++){const p=t[u][h].value,f=t[u][3+h].value,$=t[u][6+h].value,m=t[3+u][h].value,g=t[3+u][3+h].value,_=t[3+u][6+h].value,w=t[6+u][h].value,O=t[6+u][3+h].value,i=t[6+u][6+h].value;if(p){if(e.has(p))return console.log("duplicate in square",0),!0;e.add(p)}if(f){if(l.has(f))return console.log("duplicate in square",1),!0;l.add(f)}if($){if(a.has($))return console.log("duplicate in square",2),!0;a.add($)}if(m){if(n.has(m))return console.log("duplicate in square",3),!0;n.add(m)}if(g){if(s.has(g))return console.log("duplicate in square",4),!0;s.add(g)}if(_){if(r.has(_))return console.log("duplicate in square",5),!0;r.add(_)}if(w){if(c.has(w))return console.log("duplicate in square",6),!0;c.add(w)}if(O){if(o.has(O))return console.log("duplicate in square",7),!0;o.add(O)}if(i){if(v.has(i))return console.log("duplicate in square",8),!0;v.add(i)}}return!1},Q=t=>{for(let e=0;e<9;e++)for(let l=0;l<9;l++)if(!t[e][l].value)return!1;return!0},Ve=t=>Q(t)&&!Y(t),Je=()=>{const t=_e(),e=[];for(let a=0;a<9;a++)for(let n=0;n<9;n++)e.push({row:a,col:n});const l=30;for(let a=81;a>l;a--){const n=Math.floor(Math.random()*e.length),{row:s,col:r}=e[n];t[s][r].value=void 0,t[s][r].notes=[],t[s][r].fixed=!1,e.splice(n,1)}for(const{row:a,col:n}of e)t[a][n].fixed=!0;return t},_e=()=>{const t=ke();let e=0;for(;!Q(t)&&e<81;)e++,Se(t);return Ve(t)?(console.log("Got valid grid"),t):_e()},Z=(t,e,l,a)=>{if(t[e][l].value)return!1;const n=t[e][l].notes.indexOf(a);return n===-1?!1:(t[e][l].notes.splice(n,1),t[e][l].notes.length===1?(t[e][l].value=t[e][l].notes.pop(),!0):!1)},Se=t=>{const e=JSON.stringify(t);try{if(ye(t),$e(t),Y(t))throw new Error("Step created error")}catch{console.log("restoring previous version");const a=JSON.parse(e);for(let n=0;n<9;n++)for(let s=0;s<9;s++)t[n][s]={...a[n][s]}}},$e=t=>{if(Q(t))return;if(Y(t))throw new Error("Cant collapse a grid with errors");let e=!1;for(let l=0;l<9;l++)for(let a=0;a<9;a++){const{value:n}=t[l][a];if(!n)continue;for(let c=0;c<9;c++)e=e||Z(t,c,a,n),e=e||Z(t,l,c,n);const s=Math.floor(a/3),r=Math.floor(l/3);for(let c=0;c<3;c++)for(let o=0;o<3;o++)e=e||Z(t,3*r+c,3*s+o,n)}e&&$e(t)},Ne=(t,e)=>{const{row:l,col:a,value:n}=e;if(t[l][a].value)throw new Error(`cant apply choice ${e} to cell ${l},${a}. Value already set`);if(!t[l][a].notes.includes(n))throw new Error(`cant apply choice ${e} to cell ${l},${a}. New value not in notes`);t[l][a].value=n,t[l][a].notes=[]},ye=t=>{if(Q(t))return;if(Y(t))throw new Error("Cant pick position in a grid with errors");let e=[],l=9;for(let o=0;o<9;o++)for(let v=0;v<9;v++){const{value:u}=t[o][v];if(!u){const h=t[o][v].notes.length;h<l&&(l=h),e.push({row:o,col:v,nbNotes:h})}}if(!e.length)throw new Error("No open position that should not happen");e=e.filter(o=>o.nbNotes===l);const a=Math.floor(Math.random()*e.length),{row:n,col:s}=e[a],r=Math.floor(Math.random()*t[n][s].notes.length),c=t[n][s].notes[r];Ne(t,{row:n,col:s,value:c})};function ie(t,e,l){const a=t.slice();return a[7]=e[l],a}function ue(t){let e,l,a,n,s,r="Close",c,o,v,u,h=L([1,2,3,4,5,6,7,8,9]),p=[];for(let f=0;f<9;f+=1)p[f]=fe(ie(t,h,f));return{c(){e=I("div"),l=I("div"),a=I("h3"),n=A(`Pick number
                `),s=I("button"),s.textContent=r,c=C(),o=I("div");for(let f=0;f<9;f+=1)p[f].c();this.h()},l(f){e=T(f,"DIV",{role:!0,class:!0});var $=B(e);l=T($,"DIV",{class:!0});var m=B(l);a=T(m,"H3",{class:!0});var g=B(a);n=K(g,`Pick number
                `),s=T(g,"BUTTON",{"data-svelte-h":!0}),ge(s)!=="svelte-2m9p61"&&(s.textContent=r),g.forEach(q),c=M(m),o=T(m,"DIV",{class:!0});var _=B(o);for(let w=0;w<9;w+=1)p[w].l(_);_.forEach(q),m.forEach(q),$.forEach(q),this.h()},h(){D(a,"class","title-bar svelte-150tksz"),D(o,"class","grid svelte-150tksz"),D(l,"class","contents svelte-150tksz"),D(e,"role","dialog"),D(e,"class","modal svelte-150tksz")},m(f,$){R(f,e,$),b(e,l),b(l,a),b(a,n),b(a,s),b(l,c),b(l,o);for(let m=0;m<9;m+=1)p[m]&&p[m].m(o,null);v||(u=J(s,"click",be),v=!0)},p(f,$){if($&6){h=L([1,2,3,4,5,6,7,8,9]);let m;for(m=0;m<9;m+=1){const g=ie(f,h,m);p[m]?p[m].p(g,$):(p[m]=fe(g),p[m].c(),p[m].m(o,null))}for(;m<9;m+=1)p[m].d(1)}},d(f){f&&q(e),me(p,f),v=!1,u()}}}function ce(t){let e,l,a,n;function s(){return t[6](t[7])}return{c(){e=I("button"),l=A(t[7]),this.h()},l(r){e=T(r,"BUTTON",{class:!0});var c=B(e);l=K(c,t[7]),c.forEach(q),this.h()},h(){D(e,"class","choice-btn svelte-150tksz"),j(e,"selected",t[1][t[7]-1])},m(r,c){R(r,e,c),b(e,l),a||(n=J(e,"click",s),a=!0)},p(r,c){t=r,c&2&&j(e,"selected",t[1][t[7]-1])},d(r){r&&q(e),a=!1,n()}}}function fe(t){let e=t[1],l,a=ce(t);return{c(){a.c(),l=P()},l(n){a.l(n),l=P()},m(n,s){a.m(n,s),R(n,l,s)},p(n,s){s&2&&H(e,e=n[1])?(a.d(1),a=ce(n),a.c(),a.m(l.parentNode,l)):a.p(n,s)},d(n){n&&q(l),a.d(n)}}}function Ee(t){let e,l,a,n=t[0]&&ue(t);return{c(){n&&n.c(),e=P()},l(s){n&&n.l(s),e=P()},m(s,r){n&&n.m(s,r),R(s,e,r),l||(a=J(window,"keydown",t[3]),l=!0)},p(s,[r]){s[0]?n?n.p(s,r):(n=ue(s),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:F,o:F,d(s){s&&q(e),n&&n.d(s),l=!1,a()}}}function Ce(t,e,l){let{isOpen:a}=e,{onSelectionUpdated:n}=e,{initialValues:s}=e,r=new Array(9).fill(!1).map((u,h)=>s.includes(h+1));const c=u=>{l(1,r[u-1]=!r[u-1],r),l(1,r),n(r.map((h,p)=>p+1).filter(h=>r[h-1]))},o=u=>{const{key:h}=u;isNaN(Number(h))||c(Number(h))},v=u=>c(u);return t.$$set=u=>{"isOpen"in u&&l(0,a=u.isOpen),"onSelectionUpdated"in u&&l(4,n=u.onSelectionUpdated),"initialValues"in u&&l(5,s=u.initialValues)},[a,r,c,o,n,s,v]}class Me extends W{constructor(e){super(),X(this,e,Ce,Ee,H,{isOpen:0,onSelectionUpdated:4,initialValues:5})}}function de(t,e,l){const a=t.slice();return a[3]=e[l],a}function Oe(t){let e,l,a,n=L([1,2,3,4,5,6,7,8,9]),s=[];for(let r=0;r<9;r+=1)s[r]=he(de(t,n,r));return{c(){e=I("button");for(let r=0;r<9;r+=1)s[r].c();this.h()},l(r){e=T(r,"BUTTON",{class:!0});var c=B(e);for(let o=0;o<9;o+=1)s[o].l(c);c.forEach(q),this.h()},h(){D(e,"class","cell notes svelte-x580f2")},m(r,c){R(r,e,c);for(let o=0;o<9;o+=1)s[o]&&s[o].m(e,null);l||(a=J(e,"click",t[1]),l=!0)},p(r,c){if(c&1){n=L([1,2,3,4,5,6,7,8,9]);let o;for(o=0;o<9;o+=1){const v=de(r,n,o);s[o]?s[o].p(v,c):(s[o]=he(v),s[o].c(),s[o].m(e,null))}for(;o<9;o+=1)s[o].d(1)}},d(r){r&&q(e),me(s,r),l=!1,a()}}}function Ie(t){let e,l=t[0].value+"",a,n,s,r;return{c(){e=I("button"),a=A(l),this.h()},l(c){e=T(c,"BUTTON",{class:!0});var o=B(e);a=K(o,l),o.forEach(q),this.h()},h(){D(e,"class","cell value svelte-x580f2"),e.disabled=n=t[0].fixed,j(e,"fixed",t[0].fixed)},m(c,o){R(c,e,o),b(e,a),s||(r=J(e,"click",t[1]),s=!0)},p(c,o){o&1&&l!==(l=c[0].value+"")&&we(a,l),o&1&&n!==(n=c[0].fixed)&&(e.disabled=n),o&1&&j(e,"fixed",c[0].fixed)},d(c){c&&q(e),s=!1,r()}}}function pe(t){let e;return{c(){e=A(t[3])},l(l){e=K(l,t[3])},m(l,a){R(l,e,a)},d(l){l&&q(e)}}}function he(t){let e,l=t[0].notes.includes(t[3]),a,n=l&&pe(t);return{c(){e=I("div"),n&&n.c(),a=C(),this.h()},l(s){e=T(s,"DIV",{class:!0});var r=B(e);n&&n.l(r),a=M(r),r.forEach(q),this.h()},h(){D(e,"class","note svelte-x580f2")},m(s,r){R(s,e,r),n&&n.m(e,null),b(e,a)},p(s,r){r&1&&(l=s[0].notes.includes(s[3])),l?n||(n=pe(s),n.c(),n.m(e,a)):n&&(n.d(1),n=null)},d(s){s&&q(e),n&&n.d()}}}function Te(t){let e;function l(s,r){return s[0].value?Ie:Oe}let a=l(t),n=a(t);return{c(){n.c(),e=P()},l(s){n.l(s),e=P()},m(s,r){n.m(s,r),R(s,e,r)},p(s,[r]){a===(a=l(s))&&n?n.p(s,r):(n.d(1),n=a(s),n&&(n.c(),n.m(e.parentNode,e)))},i:F,o:F,d(s){s&&q(e),n.d(s)}}}function De(t,e,l){let{cell:a}=e;const n=ve(),s=()=>{let r=[];a.value?r.push(a.value):r=[...a.notes],qe(Me,{initialValues:r,onSelectionUpdated:o=>{n("cellUpdate",{cell:a,selection:o})}})};return t.$$set=r=>{"cell"in r&&l(0,a=r.cell)},[a,s]}class z extends W{constructor(e){super(),X(this,e,De,Te,H,{cell:0})}}function Re(t){let e,l,a,n,s,r,c,o,v,u,h,p,f,$,m,g,_,w,O;return l=new z({props:{cell:t[2][0]}}),l.$on("cellUpdate",t[5]),n=new z({props:{cell:t[2][1]}}),n.$on("cellUpdate",t[6]),r=new z({props:{cell:t[2][2]}}),r.$on("cellUpdate",t[7]),o=new z({props:{cell:t[2][3]}}),o.$on("cellUpdate",t[8]),u=new z({props:{cell:t[2][4]}}),u.$on("cellUpdate",t[9]),p=new z({props:{cell:t[2][5]}}),p.$on("cellUpdate",t[10]),$=new z({props:{cell:t[2][6]}}),$.$on("cellUpdate",t[11]),g=new z({props:{cell:t[2][7]}}),g.$on("cellUpdate",t[12]),w=new z({props:{cell:t[2][8]}}),w.$on("cellUpdate",t[13]),{c(){e=I("div"),k(l.$$.fragment),a=C(),k(n.$$.fragment),s=C(),k(r.$$.fragment),c=C(),k(o.$$.fragment),v=C(),k(u.$$.fragment),h=C(),k(p.$$.fragment),f=C(),k($.$$.fragment),m=C(),k(g.$$.fragment),_=C(),k(w.$$.fragment),this.h()},l(i){e=T(i,"DIV",{class:!0});var d=B(e);V(l.$$.fragment,d),a=M(d),V(n.$$.fragment,d),s=M(d),V(r.$$.fragment,d),c=M(d),V(o.$$.fragment,d),v=M(d),V(u.$$.fragment,d),h=M(d),V(p.$$.fragment,d),f=M(d),V($.$$.fragment,d),m=M(d),V(g.$$.fragment,d),_=M(d),V(w.$$.fragment,d),d.forEach(q),this.h()},h(){D(e,"class","cell-grid svelte-161j3o3"),j(e,"borderLeftRight",t[0]),j(e,"borderTopBottom",t[1])},m(i,d){R(i,e,d),S(l,e,null),b(e,a),S(n,e,null),b(e,s),S(r,e,null),b(e,c),S(o,e,null),b(e,v),S(u,e,null),b(e,h),S(p,e,null),b(e,f),S($,e,null),b(e,m),S(g,e,null),b(e,_),S(w,e,null),O=!0},p:F,i(i){O||(N(l.$$.fragment,i),N(n.$$.fragment,i),N(r.$$.fragment,i),N(o.$$.fragment,i),N(u.$$.fragment,i),N(p.$$.fragment,i),N($.$$.fragment,i),N(g.$$.fragment,i),N(w.$$.fragment,i),O=!0)},o(i){y(l.$$.fragment,i),y(n.$$.fragment,i),y(r.$$.fragment,i),y(o.$$.fragment,i),y(u.$$.fragment,i),y(p.$$.fragment,i),y($.$$.fragment,i),y(g.$$.fragment,i),y(w.$$.fragment,i),O=!1},d(i){i&&q(e),E(l),E(n),E(r),E(o),E(u),E(p),E($),E(g),E(w)}}}function Be(t,e,l){let{position:a}=e,{grid:n}=e;const s=[1,4,7].includes(a),r=[3,4,5].includes(a),c=Ue(a,n);function o(_){U.call(this,t,_)}function v(_){U.call(this,t,_)}function u(_){U.call(this,t,_)}function h(_){U.call(this,t,_)}function p(_){U.call(this,t,_)}function f(_){U.call(this,t,_)}function $(_){U.call(this,t,_)}function m(_){U.call(this,t,_)}function g(_){U.call(this,t,_)}return t.$$set=_=>{"position"in _&&l(3,a=_.position),"grid"in _&&l(4,n=_.grid)},[s,r,c,a,n,o,v,u,h,p,f,$,m,g]}class G extends W{constructor(e){super(),X(this,e,Be,Re,H,{position:3,grid:4})}}function ze(t){let e,l,a,n,s,r,c,o,v,u,h,p,f,$,m,g,_,w,O;return l=new G({props:{position:0,grid:t[0]}}),l.$on("cellUpdate",t[1]),n=new G({props:{position:1,grid:t[0]}}),n.$on("cellUpdate",t[2]),r=new G({props:{position:2,grid:t[0]}}),r.$on("cellUpdate",t[3]),o=new G({props:{position:3,grid:t[0]}}),o.$on("cellUpdate",t[4]),u=new G({props:{position:4,grid:t[0]}}),u.$on("cellUpdate",t[5]),p=new G({props:{position:5,grid:t[0]}}),p.$on("cellUpdate",t[6]),$=new G({props:{position:6,grid:t[0]}}),$.$on("cellUpdate",t[7]),g=new G({props:{position:7,grid:t[0]}}),g.$on("cellUpdate",t[8]),w=new G({props:{position:8,grid:t[0]}}),w.$on("cellUpdate",t[9]),{c(){e=I("div"),k(l.$$.fragment),a=C(),k(n.$$.fragment),s=C(),k(r.$$.fragment),c=C(),k(o.$$.fragment),v=C(),k(u.$$.fragment),h=C(),k(p.$$.fragment),f=C(),k($.$$.fragment),m=C(),k(g.$$.fragment),_=C(),k(w.$$.fragment),this.h()},l(i){e=T(i,"DIV",{class:!0});var d=B(e);V(l.$$.fragment,d),a=M(d),V(n.$$.fragment,d),s=M(d),V(r.$$.fragment,d),c=M(d),V(o.$$.fragment,d),v=M(d),V(u.$$.fragment,d),h=M(d),V(p.$$.fragment,d),f=M(d),V($.$$.fragment,d),m=M(d),V(g.$$.fragment,d),_=M(d),V(w.$$.fragment,d),d.forEach(q),this.h()},h(){D(e,"class","main-grid svelte-9ob9cf")},m(i,d){R(i,e,d),S(l,e,null),b(e,a),S(n,e,null),b(e,s),S(r,e,null),b(e,c),S(o,e,null),b(e,v),S(u,e,null),b(e,h),S(p,e,null),b(e,f),S($,e,null),b(e,m),S(g,e,null),b(e,_),S(w,e,null),O=!0},p(i,[d]){const x={};d&1&&(x.grid=i[0]),l.$set(x);const ee={};d&1&&(ee.grid=i[0]),n.$set(ee);const te={};d&1&&(te.grid=i[0]),r.$set(te);const ne={};d&1&&(ne.grid=i[0]),o.$set(ne);const le={};d&1&&(le.grid=i[0]),u.$set(le);const se={};d&1&&(se.grid=i[0]),p.$set(se);const ae={};d&1&&(ae.grid=i[0]),$.$set(ae);const re={};d&1&&(re.grid=i[0]),g.$set(re);const oe={};d&1&&(oe.grid=i[0]),w.$set(oe)},i(i){O||(N(l.$$.fragment,i),N(n.$$.fragment,i),N(r.$$.fragment,i),N(o.$$.fragment,i),N(u.$$.fragment,i),N(p.$$.fragment,i),N($.$$.fragment,i),N(g.$$.fragment,i),N(w.$$.fragment,i),O=!0)},o(i){y(l.$$.fragment,i),y(n.$$.fragment,i),y(r.$$.fragment,i),y(o.$$.fragment,i),y(u.$$.fragment,i),y(p.$$.fragment,i),y($.$$.fragment,i),y(g.$$.fragment,i),y(w.$$.fragment,i),O=!1},d(i){i&&q(e),E(l),E(n),E(r),E(o),E(u),E(p),E($),E(g),E(w)}}}function Ge(t,e,l){let{grid:a}=e;function n(f){U.call(this,t,f)}function s(f){U.call(this,t,f)}function r(f){U.call(this,t,f)}function c(f){U.call(this,t,f)}function o(f){U.call(this,t,f)}function v(f){U.call(this,t,f)}function u(f){U.call(this,t,f)}function h(f){U.call(this,t,f)}function p(f){U.call(this,t,f)}return t.$$set=f=>{"grid"in f&&l(0,a=f.grid)},[a,n,s,r,c,o,v,u,h,p]}class Le extends W{constructor(e){super(),X(this,e,Ge,ze,H,{grid:0})}}export{Le as S,Y as a,Q as b,Ve as c,_e as d,Je as e,ke as g,He as u,Se as w};
