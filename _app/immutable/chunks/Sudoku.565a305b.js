import{s as Z,e as H,i as R,y as J,G as Q,d as q,C as me,f as I,l as A,a as S,g as D,h as B,m as P,c as V,H as we,j as z,I as w,n as oe,K as ge,J as K,L as be,M as N}from"./scheduler.f51c602a.js";import{S as ee,i as te,b as y,d as E,m as C,a as M,t as O,e as T}from"./index.aa7fb691.js";import{a as x,b as ke,d as Ue}from"./store.fe9c387a.js";const qe=(t,e)=>{if(t<0||t>8)throw new Error(`unexpected square position: ${t}`);const l=Math.floor(t/3),o=t%3,n=3*l,s=3*o;return[e[n][s],e[n][s+1],e[n][s+2],e[n+1][s],e[n+1][s+1],e[n+1][s+2],e[n+2][s],e[n+2][s+1],e[n+2][s+2]]};function Se(t){return t.notes!==void 0}const Pe=(t,e)=>{if(t.fixed)throw new Error("Tried to update fixed cell");if(Se(e)){t.value=void 0,t.notes=[...e.notes];return}t.notes=[],t.value=e.value},Ve=()=>{const t=[];for(let e=0;e<9;e++){t.push([]);for(let l=0;l<9;l++){const o={value:void 0,fixed:!1,notes:[1,2,3,4,5,6,7,8,9]};t[t.length-1].push(o)}}return t},ne=t=>{for(let f=0;f<9;f++){const g=new Set,m=new Set;for(let d=0;d<9;d++){const $=t[f][d].value;if($){if(g.has($))return console.log("duplicate in row",f),!0;g.add($)}const h=t[d][f].value;if(h){if(m.has(h))return console.log("duplicate in col",f),!0;m.add(h)}}}const e=new Set,l=new Set,o=new Set,n=new Set,s=new Set,r=new Set,i=new Set,u=new Set,v=new Set;for(let f=0;f<3;f++)for(let g=0;g<3;g++){const m=t[f][g].value,d=t[f][3+g].value,$=t[f][6+g].value,h=t[3+f][g].value,p=t[3+f][3+g].value,_=t[3+f][6+g].value,k=t[6+f][g].value,U=t[6+f][3+g].value,a=t[6+f][6+g].value;if(m){if(e.has(m))return console.log("duplicate in square",0),!0;e.add(m)}if(d){if(l.has(d))return console.log("duplicate in square",1),!0;l.add(d)}if($){if(o.has($))return console.log("duplicate in square",2),!0;o.add($)}if(h){if(n.has(h))return console.log("duplicate in square",3),!0;n.add(h)}if(p){if(s.has(p))return console.log("duplicate in square",4),!0;s.add(p)}if(_){if(r.has(_))return console.log("duplicate in square",5),!0;r.add(_)}if(k){if(i.has(k))return console.log("duplicate in square",6),!0;i.add(k)}if(U){if(u.has(U))return console.log("duplicate in square",7),!0;u.add(U)}if(a){if(v.has(a))return console.log("duplicate in square",8),!0;v.add(a)}}return!1},le=t=>{for(let e=0;e<9;e++)for(let l=0;l<9;l++)if(!t[e][l].value)return!1;return!0},Ne=t=>le(t)&&!ne(t),We=()=>{const t=$e(),e=[];for(let o=0;o<9;o++)for(let n=0;n<9;n++)e.push({row:o,col:n});const l=30;for(let o=81;o>l;o--){const n=Math.floor(Math.random()*e.length),{row:s,col:r}=e[n];t[s][r].value=void 0,t[s][r].notes=[],t[s][r].fixed=!1,e.splice(n,1)}for(const{row:o,col:n}of e)t[o][n].fixed=!0;return t},$e=()=>{const t=Ve();let e=0;for(;!le(t)&&e<81;)e++,ye(t);return Ne(t)?(console.log("Got valid grid"),t):$e()},se=(t,e,l,o)=>{if(t[e][l].value)return!1;const n=t[e][l].notes.indexOf(o);return n===-1?!1:(t[e][l].notes.splice(n,1),t[e][l].notes.length===1?(t[e][l].value=t[e][l].notes.pop(),!0):!1)},ye=t=>{const e=JSON.stringify(t);try{if(Ce(t),ve(t),ne(t))throw new Error("Step created error")}catch{console.log("restoring previous version");const o=JSON.parse(e);for(let n=0;n<9;n++)for(let s=0;s<9;s++)t[n][s]={...o[n][s]}}},ve=t=>{if(le(t))return;if(ne(t))throw new Error("Cant collapse a grid with errors");let e=!1;for(let l=0;l<9;l++)for(let o=0;o<9;o++){const{value:n}=t[l][o];if(!n)continue;for(let i=0;i<9;i++)e=e||se(t,i,o,n),e=e||se(t,l,i,n);const s=Math.floor(o/3),r=Math.floor(l/3);for(let i=0;i<3;i++)for(let u=0;u<3;u++)e=e||se(t,3*r+i,3*s+u,n)}e&&ve(t)},Ee=(t,e)=>{const{row:l,col:o,value:n}=e;if(t[l][o].value)throw new Error(`cant apply choice ${e} to cell ${l},${o}. Value already set`);if(!t[l][o].notes.includes(n))throw new Error(`cant apply choice ${e} to cell ${l},${o}. New value not in notes`);t[l][o].value=n,t[l][o].notes=[]},Ce=t=>{if(le(t))return;if(ne(t))throw new Error("Cant pick position in a grid with errors");let e=[],l=9;for(let u=0;u<9;u++)for(let v=0;v<9;v++){const{value:f}=t[u][v];if(!f){const g=t[u][v].notes.length;g<l&&(l=g),e.push({row:u,col:v,nbNotes:g})}}if(!e.length)throw new Error("No open position that should not happen");e=e.filter(u=>u.nbNotes===l);const o=Math.floor(Math.random()*e.length),{row:n,col:s}=e[o],r=Math.floor(Math.random()*t[n][s].notes.length),i=t[n][s].notes[r];Ee(t,{row:n,col:s,value:i})};function ue(t,e,l){const o=t.slice();return o[12]=e[l],o}function ce(t){let e,l,o,n=t[1]?"Change notes":"Set value",s,r,i,u="Close",v,f,g,m,d,$=t[1]?"Disable notes":"Enable notes",h,p,_,k=x([1,2,3,4,5,6,7,8,9]),U=[];for(let a=0;a<9;a+=1)U[a]=de(ue(t,k,a));return{c(){e=I("div"),l=I("div"),o=I("h3"),s=A(n),r=S(),i=I("button"),i.textContent=u,v=S(),f=I("div");for(let a=0;a<9;a+=1)U[a].c();g=S(),m=I("div"),d=I("button"),h=A($),this.h()},l(a){e=D(a,"DIV",{role:!0,class:!0});var c=B(e);l=D(c,"DIV",{class:!0});var b=B(l);o=D(b,"H3",{class:!0});var G=B(o);s=P(G,n),r=V(G),i=D(G,"BUTTON",{"data-svelte-h":!0}),we(i)!=="svelte-2m9p61"&&(i.textContent=u),G.forEach(q),v=V(b),f=D(b,"DIV",{class:!0});var W=B(f);for(let L=0;L<9;L+=1)U[L].l(W);W.forEach(q),g=V(b),m=D(b,"DIV",{});var X=B(m);d=D(X,"BUTTON",{});var Y=B(d);h=P(Y,$),Y.forEach(q),X.forEach(q),b.forEach(q),c.forEach(q),this.h()},h(){z(o,"class","title-bar svelte-150tksz"),z(f,"class","grid svelte-150tksz"),z(l,"class","contents svelte-150tksz"),z(e,"role","dialog"),z(e,"class","modal svelte-150tksz")},m(a,c){R(a,e,c),w(e,l),w(l,o),w(o,s),w(o,r),w(o,i),w(l,v),w(l,f);for(let b=0;b<9;b+=1)U[b]&&U[b].m(f,null);w(l,g),w(l,m),w(m,d),w(d,h),p||(_=[J(i,"click",ke),J(d,"click",t[5])],p=!0)},p(a,c){if(c&2&&n!==(n=a[1]?"Change notes":"Set value")&&oe(s,n),c&30){k=x([1,2,3,4,5,6,7,8,9]);let b;for(b=0;b<9;b+=1){const G=ue(a,k,b);U[b]?U[b].p(G,c):(U[b]=de(G),U[b].c(),U[b].m(f,null))}for(;b<9;b+=1)U[b].d(1)}c&2&&$!==($=a[1]?"Disable notes":"Enable notes")&&oe(h,$)},d(a){a&&q(e),ge(U,a),p=!1,me(_)}}}function Me(t){let e,l,o,n;function s(){return t[11](t[12])}return{c(){e=I("button"),l=A(t[12]),this.h()},l(r){e=D(r,"BUTTON",{class:!0});var i=B(e);l=P(i,t[12]),i.forEach(q),this.h()},h(){z(e,"class","choice-btn svelte-150tksz"),K(e,"selected",t[3]===t[12])},m(r,i){R(r,e,i),w(e,l),o||(n=J(e,"click",s),o=!0)},p(r,i){t=r,i&8&&K(e,"selected",t[3]===t[12])},d(r){r&&q(e),o=!1,n()}}}function Oe(t){let e=t[2],l,o=fe(t);return{c(){o.c(),l=H()},l(n){o.l(n),l=H()},m(n,s){o.m(n,s),R(n,l,s)},p(n,s){s&4&&Z(e,e=n[2])?(o.d(1),o=fe(n),o.c(),o.m(l.parentNode,l)):o.p(n,s)},d(n){n&&q(l),o.d(n)}}}function fe(t){let e,l,o,n;function s(){return t[10](t[12])}return{c(){e=I("button"),l=A(t[12]),this.h()},l(r){e=D(r,"BUTTON",{class:!0});var i=B(e);l=P(i,t[12]),i.forEach(q),this.h()},h(){z(e,"class","choice-btn svelte-150tksz"),K(e,"selected",t[2][t[12]-1])},m(r,i){R(r,e,i),w(e,l),o||(n=J(e,"click",s),o=!0)},p(r,i){t=r,i&4&&K(e,"selected",t[2][t[12]-1])},d(r){r&&q(e),o=!1,n()}}}function de(t){let e;function l(s,r){return s[1]?Oe:Me}let o=l(t),n=o(t);return{c(){n.c(),e=H()},l(s){n.l(s),e=H()},m(s,r){n.m(s,r),R(s,e,r)},p(s,r){o===(o=l(s))&&n?n.p(s,r):(n.d(1),n=o(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&q(e),n.d(s)}}}function Te(t){let e,l,o,n=t[0]&&ce(t);return{c(){n&&n.c(),e=H()},l(s){n&&n.l(s),e=H()},m(s,r){n&&n.m(s,r),R(s,e,r),l||(o=[J(window,"keydown",t[6]),J(window,"keyup",t[7])],l=!0)},p(s,[r]){s[0]?n?n.p(s,r):(n=ce(s),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:Q,o:Q,d(s){s&&q(e),n&&n.d(s),l=!1,me(o)}}}function Ie(t,e,l){let{isOpen:o}=e,{onSelectionUpdated:n}=e,{initialState:s}=e,r=s.value===void 0,i=new Array(9).fill(!1).map((h,p)=>s.notes.includes(p+1)),u=s.value;const v=h=>{if(r){l(2,i[h-1]=!i[h-1],i),l(2,i),n({notes:i.map((p,_)=>_+1).filter(p=>i[p-1])});return}l(3,u=h),n({value:u})},f=()=>{l(1,r=!r)},g=h=>{const{key:p}=h;if(p==="Shift"){l(1,r=!0);return}isNaN(Number(p))||v(Number(p))},m=h=>{const{key:p}=h;p==="Shift"&&l(1,r=!1)},d=h=>v(h),$=h=>v(h);return t.$$set=h=>{"isOpen"in h&&l(0,o=h.isOpen),"onSelectionUpdated"in h&&l(8,n=h.onSelectionUpdated),"initialState"in h&&l(9,s=h.initialState)},[o,r,i,u,v,f,g,m,n,s,d,$]}class De extends ee{constructor(e){super(),te(this,e,Ie,Te,Z,{isOpen:0,onSelectionUpdated:8,initialState:9})}}function he(t,e,l){const o=t.slice();return o[3]=e[l],o}function Be(t){let e,l,o,n=x([1,2,3,4,5,6,7,8,9]),s=[];for(let r=0;r<9;r+=1)s[r]=_e(he(t,n,r));return{c(){e=I("button");for(let r=0;r<9;r+=1)s[r].c();this.h()},l(r){e=D(r,"BUTTON",{class:!0});var i=B(e);for(let u=0;u<9;u+=1)s[u].l(i);i.forEach(q),this.h()},h(){z(e,"class","cell notes svelte-x580f2")},m(r,i){R(r,e,i);for(let u=0;u<9;u+=1)s[u]&&s[u].m(e,null);l||(o=J(e,"click",t[1]),l=!0)},p(r,i){if(i&1){n=x([1,2,3,4,5,6,7,8,9]);let u;for(u=0;u<9;u+=1){const v=he(r,n,u);s[u]?s[u].p(v,i):(s[u]=_e(v),s[u].c(),s[u].m(e,null))}for(;u<9;u+=1)s[u].d(1)}},d(r){r&&q(e),ge(s,r),l=!1,o()}}}function Re(t){let e,l=t[0].value+"",o,n,s,r;return{c(){e=I("button"),o=A(l),this.h()},l(i){e=D(i,"BUTTON",{class:!0});var u=B(e);o=P(u,l),u.forEach(q),this.h()},h(){z(e,"class","cell value svelte-x580f2"),e.disabled=n=t[0].fixed,K(e,"fixed",t[0].fixed)},m(i,u){R(i,e,u),w(e,o),s||(r=J(e,"click",t[1]),s=!0)},p(i,u){u&1&&l!==(l=i[0].value+"")&&oe(o,l),u&1&&n!==(n=i[0].fixed)&&(e.disabled=n),u&1&&K(e,"fixed",i[0].fixed)},d(i){i&&q(e),s=!1,r()}}}function pe(t){let e;return{c(){e=A(t[3])},l(l){e=P(l,t[3])},m(l,o){R(l,e,o)},d(l){l&&q(e)}}}function _e(t){let e,l=t[0].notes.includes(t[3]),o,n=l&&pe(t);return{c(){e=I("div"),n&&n.c(),o=S(),this.h()},l(s){e=D(s,"DIV",{class:!0});var r=B(e);n&&n.l(r),o=V(r),r.forEach(q),this.h()},h(){z(e,"class","note svelte-x580f2")},m(s,r){R(s,e,r),n&&n.m(e,null),w(e,o)},p(s,r){r&1&&(l=s[0].notes.includes(s[3])),l?n||(n=pe(s),n.c(),n.m(e,o)):n&&(n.d(1),n=null)},d(s){s&&q(e),n&&n.d()}}}function ze(t){let e;function l(s,r){return s[0].value?Re:Be}let o=l(t),n=o(t);return{c(){n.c(),e=H()},l(s){n.l(s),e=H()},m(s,r){n.m(s,r),R(s,e,r)},p(s,[r]){o===(o=l(s))&&n?n.p(s,r):(n.d(1),n=o(s),n&&(n.c(),n.m(e.parentNode,e)))},i:Q,o:Q,d(s){s&&q(e),n.d(s)}}}function Ge(t,e,l){let{cell:o}=e;const n=be(),s=()=>{Ue(De,{initialState:o,onSelectionUpdated:i=>{n("cellUpdate",{cell:o,update:i})}})};return t.$$set=r=>{"cell"in r&&l(0,o=r.cell)},[o,s]}class j extends ee{constructor(e){super(),te(this,e,Ge,ze,Z,{cell:0})}}function je(t){let e,l,o,n,s,r,i,u,v,f,g,m,d,$,h,p,_,k,U;return l=new j({props:{cell:t[2][0]}}),l.$on("cellUpdate",t[5]),n=new j({props:{cell:t[2][1]}}),n.$on("cellUpdate",t[6]),r=new j({props:{cell:t[2][2]}}),r.$on("cellUpdate",t[7]),u=new j({props:{cell:t[2][3]}}),u.$on("cellUpdate",t[8]),f=new j({props:{cell:t[2][4]}}),f.$on("cellUpdate",t[9]),m=new j({props:{cell:t[2][5]}}),m.$on("cellUpdate",t[10]),$=new j({props:{cell:t[2][6]}}),$.$on("cellUpdate",t[11]),p=new j({props:{cell:t[2][7]}}),p.$on("cellUpdate",t[12]),k=new j({props:{cell:t[2][8]}}),k.$on("cellUpdate",t[13]),{c(){e=I("div"),y(l.$$.fragment),o=S(),y(n.$$.fragment),s=S(),y(r.$$.fragment),i=S(),y(u.$$.fragment),v=S(),y(f.$$.fragment),g=S(),y(m.$$.fragment),d=S(),y($.$$.fragment),h=S(),y(p.$$.fragment),_=S(),y(k.$$.fragment),this.h()},l(a){e=D(a,"DIV",{class:!0});var c=B(e);E(l.$$.fragment,c),o=V(c),E(n.$$.fragment,c),s=V(c),E(r.$$.fragment,c),i=V(c),E(u.$$.fragment,c),v=V(c),E(f.$$.fragment,c),g=V(c),E(m.$$.fragment,c),d=V(c),E($.$$.fragment,c),h=V(c),E(p.$$.fragment,c),_=V(c),E(k.$$.fragment,c),c.forEach(q),this.h()},h(){z(e,"class","cell-grid svelte-161j3o3"),K(e,"borderLeftRight",t[0]),K(e,"borderTopBottom",t[1])},m(a,c){R(a,e,c),C(l,e,null),w(e,o),C(n,e,null),w(e,s),C(r,e,null),w(e,i),C(u,e,null),w(e,v),C(f,e,null),w(e,g),C(m,e,null),w(e,d),C($,e,null),w(e,h),C(p,e,null),w(e,_),C(k,e,null),U=!0},p:Q,i(a){U||(M(l.$$.fragment,a),M(n.$$.fragment,a),M(r.$$.fragment,a),M(u.$$.fragment,a),M(f.$$.fragment,a),M(m.$$.fragment,a),M($.$$.fragment,a),M(p.$$.fragment,a),M(k.$$.fragment,a),U=!0)},o(a){O(l.$$.fragment,a),O(n.$$.fragment,a),O(r.$$.fragment,a),O(u.$$.fragment,a),O(f.$$.fragment,a),O(m.$$.fragment,a),O($.$$.fragment,a),O(p.$$.fragment,a),O(k.$$.fragment,a),U=!1},d(a){a&&q(e),T(l),T(n),T(r),T(u),T(f),T(m),T($),T(p),T(k)}}}function Fe(t,e,l){let{position:o}=e,{grid:n}=e;const s=[1,4,7].includes(o),r=[3,4,5].includes(o),i=qe(o,n);function u(_){N.call(this,t,_)}function v(_){N.call(this,t,_)}function f(_){N.call(this,t,_)}function g(_){N.call(this,t,_)}function m(_){N.call(this,t,_)}function d(_){N.call(this,t,_)}function $(_){N.call(this,t,_)}function h(_){N.call(this,t,_)}function p(_){N.call(this,t,_)}return t.$$set=_=>{"position"in _&&l(3,o=_.position),"grid"in _&&l(4,n=_.grid)},[s,r,i,o,n,u,v,f,g,m,d,$,h,p]}class F extends ee{constructor(e){super(),te(this,e,Fe,je,Z,{position:3,grid:4})}}function He(t){let e,l,o,n,s,r,i,u,v,f,g,m,d,$,h,p,_,k,U;return l=new F({props:{position:0,grid:t[0]}}),l.$on("cellUpdate",t[1]),n=new F({props:{position:1,grid:t[0]}}),n.$on("cellUpdate",t[2]),r=new F({props:{position:2,grid:t[0]}}),r.$on("cellUpdate",t[3]),u=new F({props:{position:3,grid:t[0]}}),u.$on("cellUpdate",t[4]),f=new F({props:{position:4,grid:t[0]}}),f.$on("cellUpdate",t[5]),m=new F({props:{position:5,grid:t[0]}}),m.$on("cellUpdate",t[6]),$=new F({props:{position:6,grid:t[0]}}),$.$on("cellUpdate",t[7]),p=new F({props:{position:7,grid:t[0]}}),p.$on("cellUpdate",t[8]),k=new F({props:{position:8,grid:t[0]}}),k.$on("cellUpdate",t[9]),{c(){e=I("div"),y(l.$$.fragment),o=S(),y(n.$$.fragment),s=S(),y(r.$$.fragment),i=S(),y(u.$$.fragment),v=S(),y(f.$$.fragment),g=S(),y(m.$$.fragment),d=S(),y($.$$.fragment),h=S(),y(p.$$.fragment),_=S(),y(k.$$.fragment),this.h()},l(a){e=D(a,"DIV",{class:!0});var c=B(e);E(l.$$.fragment,c),o=V(c),E(n.$$.fragment,c),s=V(c),E(r.$$.fragment,c),i=V(c),E(u.$$.fragment,c),v=V(c),E(f.$$.fragment,c),g=V(c),E(m.$$.fragment,c),d=V(c),E($.$$.fragment,c),h=V(c),E(p.$$.fragment,c),_=V(c),E(k.$$.fragment,c),c.forEach(q),this.h()},h(){z(e,"class","main-grid svelte-9ob9cf")},m(a,c){R(a,e,c),C(l,e,null),w(e,o),C(n,e,null),w(e,s),C(r,e,null),w(e,i),C(u,e,null),w(e,v),C(f,e,null),w(e,g),C(m,e,null),w(e,d),C($,e,null),w(e,h),C(p,e,null),w(e,_),C(k,e,null),U=!0},p(a,[c]){const b={};c&1&&(b.grid=a[0]),l.$set(b);const G={};c&1&&(G.grid=a[0]),n.$set(G);const W={};c&1&&(W.grid=a[0]),r.$set(W);const X={};c&1&&(X.grid=a[0]),u.$set(X);const Y={};c&1&&(Y.grid=a[0]),f.$set(Y);const L={};c&1&&(L.grid=a[0]),m.$set(L);const re={};c&1&&(re.grid=a[0]),$.$set(re);const ae={};c&1&&(ae.grid=a[0]),p.$set(ae);const ie={};c&1&&(ie.grid=a[0]),k.$set(ie)},i(a){U||(M(l.$$.fragment,a),M(n.$$.fragment,a),M(r.$$.fragment,a),M(u.$$.fragment,a),M(f.$$.fragment,a),M(m.$$.fragment,a),M($.$$.fragment,a),M(p.$$.fragment,a),M(k.$$.fragment,a),U=!0)},o(a){O(l.$$.fragment,a),O(n.$$.fragment,a),O(r.$$.fragment,a),O(u.$$.fragment,a),O(f.$$.fragment,a),O(m.$$.fragment,a),O($.$$.fragment,a),O(p.$$.fragment,a),O(k.$$.fragment,a),U=!1},d(a){a&&q(e),T(l),T(n),T(r),T(u),T(f),T(m),T($),T(p),T(k)}}}function Je(t,e,l){let{grid:o}=e;function n(d){N.call(this,t,d)}function s(d){N.call(this,t,d)}function r(d){N.call(this,t,d)}function i(d){N.call(this,t,d)}function u(d){N.call(this,t,d)}function v(d){N.call(this,t,d)}function f(d){N.call(this,t,d)}function g(d){N.call(this,t,d)}function m(d){N.call(this,t,d)}return t.$$set=d=>{"grid"in d&&l(0,o=d.grid)},[o,n,s,r,i,u,v,f,g,m]}class Xe extends ee{constructor(e){super(),te(this,e,Je,He,Z,{grid:0})}}export{Xe as S,ne as a,le as b,Ne as c,$e as d,We as e,Ve as g,Pe as u,ye as w};
