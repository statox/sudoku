import{s as Ht,f as C,a as T,e as Nt,g as b,h as W,H as I,c as E,d as N,j as nt,i as M,I as d,y as H,J as gt,C as Ft,D as At,l as Jt,m as zt,K as xt,G as Wt,E as Kt}from"../chunks/scheduler.71239b2e.js";import{S as Lt,i as Qt,t as st,c as Xt,a as lt,b as Tt,d as Et,m as $t,e as jt,g as Yt}from"../chunks/index.8ab45ecd.js";import{a as Ot}from"../chunks/store.fe58922c.js";import{d as vt,m as Zt,g as te,a as Ut,b as ee,c as Bt,e as oe,S as ne,G as se,u as le,r as ce,s as Rt,f as re,h as ae,i as St}from"../chunks/GridStatus.a50308e0.js";const ie=t=>{const o=vt(t);return Pt(o),o},Pt=t=>{for(let o=0;o<9;o++)for(let e=0;e<9;e++)if(t[o][e].value===void 0){for(let n=1;n<=9;n++)if(Zt(t,{row:o,col:e},n)){if(t[o][e].value=n,Pt(t))return!0;t[o][e].value=void 0}return!1}return!0},Vt=()=>{const t=te();let o=0;for(;!Ut(t)&&o<81;)o++,ue(t);return ee(t)?t:Vt()},_t=(t,o,e,n)=>{if(t[o][e].value)return!1;const c=t[o][e].notes.indexOf(n);return c===-1?!1:(t[o][e].notes.splice(c,1),t[o][e].notes.length===1?(t[o][e].value=t[o][e].notes.pop(),!0):!1)},ue=t=>{const o=JSON.stringify(t);try{if(he(t),Dt(t),Bt(t))throw new Error("Step created error")}catch{const n=JSON.parse(o);for(let c=0;c<9;c++)for(let l=0;l<9;l++)t[c][l]={...n[c][l]}}},Dt=t=>{if(Ut(t))return;if(Bt(t))throw new Error("Cant collapse a grid with errors");let o=!1;for(let e=0;e<9;e++)for(let n=0;n<9;n++){const{value:c}=t[e][n];if(!c)continue;for(let u=0;u<9;u++)o=o||_t(t,u,n,c),o=o||_t(t,e,u,c);const l=Math.floor(n/3),a=Math.floor(e/3);for(let u=0;u<3;u++)for(let s=0;s<3;s++)o=o||_t(t,3*a+u,3*l+s,c)}o&&Dt(t)},fe=(t,o)=>{const{row:e,col:n,value:c}=o;if(t[e][n].value)throw new Error(`cant apply choice ${o} to cell ${e},${n}. Value already set`);if(!t[e][n].notes.includes(c))throw new Error(`cant apply choice ${o} to cell ${e},${n}. New value not in notes`);t[e][n].value=c,t[e][n].notes=[]},he=t=>{let o=[],e=9;for(let s=0;s<9;s++)for(let i=0;i<9;i++){const{value:x}=t[s][i];if(!x){const h=t[s][i].notes.length;h<e&&(e=h),o.push({row:s,col:i,nbNotes:h})}}if(!o.length)throw new Error("No open position that should not happen");o=o.filter(s=>s.nbNotes===e);const n=Math.floor(Math.random()*o.length),{row:c,col:l}=o[n],a=Math.floor(Math.random()*t[c][l].notes.length),u=t[c][l].notes[a];fe(t,{row:c,col:l,value:u})},Gt=()=>{const t=Vt(),o=[];for(let e=0;e<9;e++)for(let n=0;n<9;n++)o.push({row:e,col:n});for(;o.length;){const e=Math.floor(Math.random()*o.length),{row:n,col:c}=o[e];o.splice(e,1);const l=t[n][c].value;t[n][c].value=void 0,t[n][c].notes=[],t[n][c].fixed=!1,oe(t)!=="unique"&&(t[n][c].value=l)}for(let e=0;e<9;e++)for(let n=0;n<9;n++)t[e][n].value&&(t[e][n].fixed=!0);return t},_e=t=>{const o=[];for(let e=0;e<9;e++){const n={},c={},l={},a=3*Math.floor(e/3),u=3*(e%3);for(let s=0;s<9;s++){if(t[e][s].value===void 0){const v=t[e][s].notes;for(const w of v)n[w]||(n[w]=[]),n[w].push({row:e,col:s})}if(t[s][e].value===void 0){const v=t[s][e].notes;for(const w of v)c[w]||(c[w]=[]),c[w].push({row:s,col:e})}const i=Math.floor(s/3),x=s%3,h=a+i,p=u+x;if(t[h][p].value===void 0){const v=t[h][p].notes;for(const w of v)l[w]||(l[w]=[]),l[w].push({row:h,col:p})}}for(const s of Object.keys(n)){const i=Number(s);if(n[i].length===1){const{row:x,col:h}=n[i][0];o.push({type:"hidden_single_row",cause:[{row:x,col:h,notes:[i]}]})}}for(const s of Object.keys(c)){const i=Number(s);if(c[i].length===1){const{row:x,col:h}=c[i][0];o.push({type:"hidden_single_col",cause:[{row:x,col:h,notes:[i]}]})}}for(const s of Object.keys(l)){const i=Number(s);if(l[i].length===1){const{row:x,col:h}=l[i][0];o.push({type:"hidden_single_square",cause:[{row:x,col:h,notes:[i]}]})}}}return o},ve=t=>{const o=[];for(let e=0;e<9;e++)for(let n=0;n<9;n++)t[e][n].value===void 0&&t[e][n].notes.length===1&&o.push({type:"lone_single",cause:[{row:e,col:n,notes:[t[e][n].notes[0]]}]});return o},de=t=>{const o=[];for(let e=0;e<9;e++){const n={},c={},l={},a=3*Math.floor(e/3),u=3*(e%3);for(let s=0;s<9;s++){if(t[e][s].value===void 0&&t[e][s].notes.length===2){const v=t[e][s].notes.join(",");if(!n[v])n[v]={row:e,col:s};else{const w={row:e,col:s,notes:[...t[e][s].notes]},$={row:n[v].row,col:n[v].col,notes:[...t[e][s].notes]},R=[];for(let k=0;k<9;k++)t[e][k].value!==void 0||t[e][k].notes.join(",")===v||R.push({row:e,col:k,notes:[...t[e][s].notes]});o.push({type:"naked_pair",cause:[w,$],effect:R})}}if(t[s][e].value===void 0&&t[s][e].notes.length===2){const v=t[s][e].notes.join(",");if(!c[v])c[v]={row:s,col:e};else{const w={row:s,col:e,notes:[...t[s][e].notes]},$={row:c[v].row,col:c[v].col,notes:[...t[s][e].notes]},R=[];for(let k=0;k<9;k++)t[k][e].value!==void 0||t[k][e].notes.join(",")===v||R.push({row:k,col:e,notes:[...t[s][e].notes]});o.push({type:"naked_pair",cause:[w,$],effect:R})}}const i=Math.floor(s/3),x=s%3,h=a+i,p=u+x;if(t[h][p].value===void 0&&t[h][p].notes.length===2){const v=t[h][p].notes.join(",");if(!l[v])l[v]={row:h,col:p};else{const w={row:h,col:p,notes:[...t[h][p].notes]},$={row:l[v].row,col:l[v].col,notes:[...t[h][p].notes]},R=[];for(let k=0;k<9;k++){const q=Math.floor(k/3),Q=k%3,U=a+q,j=u+Q;t[U][j].value!==void 0||t[U][j].notes.join(",")===v||R.push({row:U,col:j,notes:[...t[h][p].notes]})}o.push({type:"naked_pair",cause:[w,$],effect:R})}}}}return o};function It(t,o,e){const n=t.slice();return n[20]=o[e],n}function Mt(t){let o,e,n,c;function l(){return t[19](t[20])}return{c(){o=C("button"),e=Jt(t[20]),this.h()},l(a){o=b(a,"BUTTON",{class:!0});var u=W(o);e=zt(u,t[20]),u.forEach(N),this.h()},h(){nt(o,"class","svelte-1jeisuy"),xt(o,"selected",t[1]===t[20])},m(a,u){M(a,o,u),d(o,e),n||(c=H(o,"click",l),n=!0)},p(a,u){t=a,u&2&&xt(o,"selected",t[1]===t[20])},d(a){a&&N(o),n=!1,c()}}}function qt(t){let o,e,n,c;return o=new ne({props:{grid:t[0]}}),o.$on("cellUpdate",t[3]),o.$on("computeCellNotes",t[4]),n=new se({props:{grid:t[0]}}),{c(){Tt(o.$$.fragment),e=T(),Tt(n.$$.fragment)},l(l){Et(o.$$.fragment,l),e=E(l),Et(n.$$.fragment,l)},m(l,a){$t(o,l,a),M(l,e,a),$t(n,l,a),c=!0},p(l,a){const u={};a&1&&(u.grid=l[0]),o.$set(u);const s={};a&1&&(s.grid=l[0]),n.$set(s)},i(l){c||(lt(o.$$.fragment,l),lt(n.$$.fragment,l),c=!0)},o(l){st(o.$$.fragment,l),st(n.$$.fragment,l),c=!1},d(l){l&&N(e),jt(o,l),jt(n,l)}}}function pe(t){let o,e,n="Grid controls",c,l,a,u="Prev",s,i,x="New Grid",h,p,v="Solve grid",w,$,R="Reset grid",k,q,Q="Remove fixed",U,j,V,f="Notes controls",O,y,D,dt="Compute notes",ct,g,pt="Remove notes",rt,F,wt="Display hints",at,A,kt="Hide hints",X,B,K,mt="Highlights controls",it,J,Y,Z,tt,Ct=t[0],L,et,ut,bt,ft=Ot([1,2,3,4,5,6,7,8,9]),S=[];for(let r=0;r<9;r+=1)S[r]=Mt(It(t,ft,r));let G=qt(t);return{c(){o=C("div"),e=C("h4"),e.textContent=n,c=T(),l=C("div"),a=C("button"),a.textContent=u,s=T(),i=C("button"),i.textContent=x,h=T(),p=C("button"),p.textContent=v,w=T(),$=C("button"),$.textContent=R,k=T(),q=C("button"),q.textContent=Q,U=T(),j=C("div"),V=C("h4"),V.textContent=f,O=T(),y=C("div"),D=C("button"),D.textContent=dt,ct=T(),g=C("button"),g.textContent=pt,rt=T(),F=C("button"),F.textContent=wt,at=T(),A=C("button"),A.textContent=kt,X=T(),B=C("div"),K=C("h4"),K.textContent=mt,it=T(),J=C("div");for(let r=0;r<9;r+=1)S[r].c();Y=T(),Z=C("br"),tt=T(),G.c(),L=Nt(),this.h()},l(r){o=b(r,"DIV",{});var m=W(o);e=b(m,"H4",{"data-svelte-h":!0}),I(e)!=="svelte-1h8cvtc"&&(e.textContent=n),c=E(m),l=b(m,"DIV",{class:!0});var _=W(l);a=b(_,"BUTTON",{"data-svelte-h":!0}),I(a)!=="svelte-bivxk4"&&(a.textContent=u),s=E(_),i=b(_,"BUTTON",{"data-svelte-h":!0}),I(i)!=="svelte-1oh0e6u"&&(i.textContent=x),h=E(_),p=b(_,"BUTTON",{"data-svelte-h":!0}),I(p)!=="svelte-1wjgins"&&(p.textContent=v),w=E(_),$=b(_,"BUTTON",{"data-svelte-h":!0}),I($)!=="svelte-69m1bk"&&($.textContent=R),k=E(_),q=b(_,"BUTTON",{"data-svelte-h":!0}),I(q)!=="svelte-g7g4he"&&(q.textContent=Q),_.forEach(N),m.forEach(N),U=E(r),j=b(r,"DIV",{});var z=W(j);V=b(z,"H4",{"data-svelte-h":!0}),I(V)!=="svelte-8gx0az"&&(V.textContent=f),O=E(z),y=b(z,"DIV",{class:!0});var P=W(y);D=b(P,"BUTTON",{"data-svelte-h":!0}),I(D)!=="svelte-12olw78"&&(D.textContent=dt),ct=E(P),g=b(P,"BUTTON",{"data-svelte-h":!0}),I(g)!=="svelte-16z5c15"&&(g.textContent=pt),rt=E(P),F=b(P,"BUTTON",{"data-svelte-h":!0}),I(F)!=="svelte-mp8c3v"&&(F.textContent=wt),at=E(P),A=b(P,"BUTTON",{"data-svelte-h":!0}),I(A)!=="svelte-eks63j"&&(A.textContent=kt),P.forEach(N),z.forEach(N),X=E(r),B=b(r,"DIV",{});var ot=W(B);K=b(ot,"H4",{"data-svelte-h":!0}),I(K)!=="svelte-hclwgd"&&(K.textContent=mt),it=E(ot),J=b(ot,"DIV",{class:!0});var yt=W(J);for(let ht=0;ht<9;ht+=1)S[ht].l(yt);yt.forEach(N),ot.forEach(N),Y=E(r),Z=b(r,"BR",{}),tt=E(r),G.l(r),L=Nt(),this.h()},h(){nt(l,"class","grid-controls svelte-1jeisuy"),nt(y,"class","notes-controls svelte-1jeisuy"),nt(J,"class","highlights-controls")},m(r,m){M(r,o,m),d(o,e),d(o,c),d(o,l),d(l,a),d(l,s),d(l,i),d(l,h),d(l,p),d(l,w),d(l,$),d(l,k),d(l,q),M(r,U,m),M(r,j,m),d(j,V),d(j,O),d(j,y),d(y,D),d(y,ct),d(y,g),d(y,rt),d(y,F),d(y,at),d(y,A),M(r,X,m),M(r,B,m),d(B,K),d(B,it),d(B,J);for(let _=0;_<9;_+=1)S[_]&&S[_].m(J,null);M(r,Y,m),M(r,Z,m),M(r,tt,m),G.m(r,m),M(r,L,m),et=!0,ut||(bt=[H(a,"click",t[10]),H(i,"click",t[11]),H(p,"click",t[12]),H($,"click",t[13]),H(q,"click",t[14]),H(D,"click",t[15]),H(g,"click",t[16]),H(F,"click",t[17]),H(A,"click",t[18])],ut=!0)},p(r,[m]){if(m&2){ft=Ot([1,2,3,4,5,6,7,8,9]);let _;for(_=0;_<9;_+=1){const z=It(r,ft,_);S[_]?S[_].p(z,m):(S[_]=Mt(z),S[_].c(),S[_].m(J,null))}for(;_<9;_+=1)S[_].d(1)}m&1&&Ht(Ct,Ct=r[0])?(Yt(),st(G,1,1,Wt),Xt(),G=qt(r),G.c(),lt(G,1),G.m(L.parentNode,L)):G.p(r,m)},i(r){et||(lt(G),et=!0)},o(r){st(G),et=!1},d(r){r&&(N(o),N(U),N(j),N(X),N(B),N(Y),N(Z),N(tt),N(L)),gt(S,r),G.d(r),ut=!1,Ft(bt)}}}function we(t,o,e){let n;At(t,St,f=>e(1,n=f));let c=Gt();const l=[vt(c)],a=f=>{le(f.detail.cell,f.detail.update),s()},u=f=>{ce(c,f.detail.position),s()},s=f=>{e(0,c),!(f!=null&&f.noHistory)&&l.push(vt(c))},i=f=>{for(let O=0;O<9;O++)for(let y=0;y<9;y++)f[O][y].fixed||(f[O][y].value=void 0,f[O][y].notes=[])},x=()=>{const f=ie(c);e(0,c=f),s()},h=()=>{for(let f=0;f<9;f++)for(let O=0;O<9;O++)e(0,c[f][O].fixed=!1,c)},p=f=>{Rt.set([...ve(f),..._e(f),...de(f)])};return[c,n,l,a,u,s,i,x,h,p,()=>{e(0,c=l.pop()),s({noHistory:!0})},()=>{e(0,c=Gt()),s()},()=>{x(),s()},()=>{i(c),s()},()=>{h(),s()},()=>{re(c),s()},()=>{ae(c),s()},()=>{p(c),s()},()=>{Rt.set([]),s()},f=>{Kt(St,n=n===f?void 0:f,n)}]}class ye extends Lt{constructor(o){super(),Qt(this,o,we,pe,Ht,{})}}export{ye as component};
